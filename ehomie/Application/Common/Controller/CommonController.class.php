<?php /* copyright Â© OpenCMF 598821125@qq.com
-- mzphp æ··æ·†åŠ å¯†ï¼šhttps://git.oschina.net/mz/mzphp2
 */?><?php ?><?php
  namespace Common\Controller;use Think\Controller;class  CommonController extends Controller{protected function display($ŠÁË='',$‘›‰='',$Ó='',$²¯='',$º­–»=''){if(!is_file($ŠÁË)){$É=C('TMPL_FILE_DEPR');if('' ==$ŠÁË){$ŠÁË=CONTROLLER_NAME.$É.ACTION_NAME;}elseif(false===strpos($ŠÁË,$É)){$ŠÁË=CONTROLLER_NAME.$É.$ŠÁË;}}else{$¸ÔªÅµ=$ŠÁË;}$®¤=array();$»¿Ë=C('CURRENT_THEME');$’¥–›=C('STATIC_DOMAIN');$‘§=$this->view->get('is_builder');if(is_wap()){$µ='./Theme/'.$»¿Ë.'/'.MODULE_NAME.'/';$©ÅÏª='./Theme/'.$»¿Ë.'/'.MODULE_NAME.'/Wap/';$®¤['TMPL_PARSE_STRING']=C('TMPL_PARSE_STRING');if($‘§){$à­ šŠ='./Theme/'.$»¿Ë.'/Home/Wap/Public';if(is_dir($à­ šŠ)){$®¤['HOME_PUBLIC_LAYOUT']=$à­ šŠ.'/layout.html';$®¤['TMPL_PARSE_STRING']['__HOME_IMG__']=$’¥–›.'/'.$à­ šŠ.'/img';$®¤['TMPL_PARSE_STRING']['__HOME_CSS__']=$’¥–›.'/'.$à­ šŠ.'/css';$®¤['TMPL_PARSE_STRING']['__HOME_JS__']=$’¥–›.'/'.$à­ šŠ.'/js';$®¤['TMPL_PARSE_STRING']['__HOME_LIBS__']=$’¥–›.'/'.$à­ šŠ.'/libs';}if(MODULE_MARK==='Home'){$¸—Áß='./Theme/'.$»¿Ë.'/Home/Wap/Builder';if(is_dir($¸—Áß)){$®¤['LISTBUILDER_LAYOUT']=$¸—Áß.'/listbuilder.html';$®¤['FORMBUILDER_LAYOUT']=$¸—Áß.'/formbuilder.html';}if(is_dir('./Theme/' .$»¿Ë.'/User/Wap')){$®¤['USER_CENTER_SIDE']='./Theme/'.$»¿Ë.'/User/Wap/Index/side.html';$®¤['USER_LOGIN_MODAL']='./Theme/'.$»¿Ë.'/User/Wap/User/login_modal.html';if(is_dir('./Theme/'.$»¿Ë.'/User/Wap/Builder')){$®¤['USER_CENTER_FORM']='./Theme/'.$»¿Ë.'/User/Wap/Builder/form.html';$®¤['USER_CENTER_LIST']='./Theme/'.$»¿Ë.'/User/Wap/Builder/list.html';if('list' ===$‘§){$ŠÁË=$®¤['USER_CENTER_LIST'];}if('form' ===$‘§){$ŠÁË=$®¤['USER_CENTER_FORM'];}}}}if(MODULE_MARK==='Home'){$®¤['VIEW_PATH']=$©ÅÏª;}else if(MODULE_MARK==='Admin' && MODULE_NAME!=='Admin'){if(is_dir($©ÅÏª.'Admin/')){$®¤['VIEW_PATH']=$©ÅÏª.'Admin/';}}$Í °='./Theme/' .$»¿Ë.'/' .MODULE_NAME.'/Wap/Public';if(is_dir($Í °)){$®¤['TMPL_PARSE_STRING']['__IMG__']=$’¥–›.'/'.$Í °.'/img';$®¤['TMPL_PARSE_STRING']['__CSS__']=$’¥–›.'/'.$Í °.'/css';$®¤['TMPL_PARSE_STRING']['__JS__']=$’¥–›.'/'.$Í °.'/js';$®¤['TMPL_PARSE_STRING']['__LIBS__']=$’¥–›.'/'.$Í °.'/libs';}}else{if(!$¸ÔªÅµ){$¸ÔªÅµ='./Theme/' .$»¿Ë.'/'.MODULE_NAME.'/Wap/' .$ŠÁË.'.html';if(!is_file($¸ÔªÅµ)&& is_dir($µ)&& !defined('IS_ADDON')){$à­ šŠ='./Theme/'.$»¿Ë.'/Home/Public';if(is_dir($à­ šŠ)){$®¤['HOME_PUBLIC_LAYOUT']=$à­ šŠ.'/layout.html';$®¤['TMPL_PARSE_STRING']['__HOME_IMG__']=$’¥–›.'/'.$à­ šŠ.'/img';$®¤['TMPL_PARSE_STRING']['__HOME_CSS__']=$’¥–›.'/'.$à­ šŠ.'/css';$®¤['TMPL_PARSE_STRING']['__HOME_JS__']=$’¥–›.'/'.$à­ šŠ.'/js';$®¤['TMPL_PARSE_STRING']['__HOME_LIBS__']=$’¥–›.'/'.$à­ šŠ.'/libs';}if(MODULE_MARK==='Home'){$¸—Áß='./Theme/'.$»¿Ë.'/Home/Builder';if(is_dir($¸—Áß)){$®¤['LISTBUILDER_LAYOUT']=$¸—Áß.'/listbuilder.html';$®¤['FORMBUILDER_LAYOUT']=$¸—Áß.'/formbuilder.html';}if(is_dir('./Theme/' .$»¿Ë.'/User')){$®¤['USER_CENTER_SIDE']='./Theme/'.$»¿Ë.'/User/Wap/Index/side.html';$®¤['USER_LOGIN_MODAL']='./Theme/'.$»¿Ë.'/User/Wap/User/login_modal.html';}}if(MODULE_MARK==='Home'){$®¤['VIEW_PATH']=$µ;}else if(MODULE_MARK==='Admin' && MODULE_NAME!=='Admin'){if(is_dir($©ÅÏª.'Admin/')){$®¤['VIEW_PATH']=$µ.'Admin/';}}$Í °='./Theme/' .$»¿Ë.'/' .MODULE_NAME.'/Public';if(is_dir($Í °)){$®¤['TMPL_PARSE_STRING']['__IMG__']=$’¥–›.'/'.$Í °.'/img';$®¤['TMPL_PARSE_STRING']['__CSS__']=$’¥–›.'/'.$Í °.'/css';$®¤['TMPL_PARSE_STRING']['__JS__']=$’¥–›.'/'.$Í °.'/js';$®¤['TMPL_PARSE_STRING']['__LIBS__']=$’¥–›.'/'.$Í °.'/libs';}}}}}C($®¤);$¦Ì['status']=0x001;$¦Âº=array();$»š=D('Admin/Module')->where($¦Ì)->getField('user_nav',true);foreach($»š as $İÌ‹=>$¬¢){if($¬¢){$¬¢=json_decode($¬¢,true);if($¬¢['main']){$¦Âº=array_merge($¦Âº,$¬¢['main']);}}}$this->assign('meta_keywords',C('WEB_SITE_KEYWORD'));$this->assign('meta_description',C('WEB_SITE_DESCRIPTION'));$this->assign('_new_message',cookie('_new_message'));$this->assign('_user_auth',session('user_auth'));$this->assign('_user_nav_main',$¦Âº);$this->assign('_user_center_side',C('USER_CENTER_SIDE'));$this->assign('_user_login_modal',C('USER_LOGIN_MODAL'));$this->assign('_admin_public_layout',C('ADMIN_PUBLIC_LAYOUT'));$this->assign('_home_public_layout',C('HOME_PUBLIC_LAYOUT'));$this->assign('_listbuilder_layout',C('LISTBUILDER_LAYOUT'));$this->assign('_formbuilder_layout',C('FORMBUILDER_LAYOUT'));$this->assign('_page_name',strtolower(MODULE_NAME.'_' .CONTROLLER_NAME.'_' .ACTION_NAME));if(IS_AJAX){$this->success('æ•°æ®è·å–æˆåŠŸ','',array('data' =>$this->view->get(),'html' =>$this->fetch($ŠÁË)));}else{$this->view->display($ŠÁË);}}}